---
import type { Locale } from '../i18n/utils';
import { getAlternateLocale, pageSlugMap, reversePageSlugMap } from '../i18n/utils';

interface Props {
  title: string;
  description: string;
  ogImage?: string;
  canonicalUrl?: string;
  locale: Locale;
  alternateUrl?: string;
}

const { title, description, ogImage, canonicalUrl, locale, alternateUrl } = Astro.props;

const siteUrl = 'https://gijsbertvandekraats.nl';
const altLocale = getAlternateLocale(locale);

// Build canonical URL
const canonical = canonicalUrl || `${siteUrl}${Astro.url.pathname}`;

// Build alternate URL for hreflang
function getAlternateUrl(): string {
  if (alternateUrl) return alternateUrl;

  const pathname = Astro.url.pathname;
  // Extract the slug after /nl/ or /en/
  const parts = pathname.replace(/^\//, '').replace(/\/$/, '').split('/');
  const currentLocale = parts[0];
  const slug = parts[1] || '';

  if (!slug) {
    // Home page
    return `${siteUrl}/${altLocale}`;
  }

  // Find the alternate slug
  let altSlug: string;
  if (currentLocale === 'nl') {
    altSlug = pageSlugMap[slug] || slug;
  } else {
    altSlug = reversePageSlugMap[slug] || slug;
  }

  return `${siteUrl}/${altLocale}/${altSlug}`;
}

const altUrl = getAlternateUrl();
const ogImg = ogImage || `${siteUrl}/images/og-default.jpg`;
const ogLocale = locale === 'nl' ? 'nl_NL' : 'en_US';
const altOgLocale = locale === 'nl' ? 'en_US' : 'nl_NL';
---

<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<title>{title}</title>
<meta name="description" content={description} />

<!-- Canonical -->
<link rel="canonical" href={canonical} />

<!-- Hreflang alternates -->
<link rel="alternate" hreflang={locale} href={canonical} />
<link rel="alternate" hreflang={altLocale} href={altUrl} />
<link rel="alternate" hreflang="x-default" href={`${siteUrl}/nl`} />

<!-- Open Graph -->
<meta property="og:type" content="website" />
<meta property="og:title" content={title} />
<meta property="og:description" content={description} />
<meta property="og:image" content={ogImg} />
<meta property="og:url" content={canonical} />
<meta property="og:locale" content={ogLocale} />
<meta property="og:locale:alternate" content={altOgLocale} />
<meta property="og:site_name" content="Gijsbert van de Kraats" />

<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content={title} />
<meta name="twitter:description" content={description} />
<meta name="twitter:image" content={ogImg} />

<!-- Google Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link
  href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=DM+Sans:wght@400;500;700&display=swap"
  rel="stylesheet"
/>

<!-- Favicon -->
<link rel="icon" type="image/svg+xml" href="/favicon.svg" />

<!-- Schema.org LocalBusiness JSON-LD -->
<script type="application/ld+json" set:html={JSON.stringify({
  "@context": "https://schema.org",
  "@type": "LocalBusiness",
  "name": "Gijsbert van de Kraats",
  "description": "Ambachtelijke patisserie, bruidstaarten en food services",
  "url": "https://gijsbertvandekraats.nl",
  "telephone": "+31612278654",
  "email": "info@gijsbertvandekraats.nl",
  "address": {
    "@type": "PostalAddress",
    "streetAddress": "Energieweg 3F",
    "addressLocality": "Meerkerk",
    "addressCountry": "NL"
  },
  "priceRange": "€€"
})} />
